!function(e) {
    function t(a) {
        function i() {
            r(),
            k.find(p).hide(),
            k.show(),
            o.trigger("show")
        }
        function n() {
            k.hide(),
            o.trigger("hide")
        }
        function r() {
            var e = []
              , t = new Date(u.year,u.month - 1,1)
              , a = t.getDay()
              , i = 0;
            if (a != u.weekStart) {
                t.setDate(0);
                var n = t.getDate()
                  , i = a - u.weekStart;
                i < 0 && (i += 7);
                for (var r = i - 1; r >= 0; r--)
                    e.push({
                        date: l(t.getFullYear(), t.getMonth() + 1, n - r),
                        day: n - r,
                        cls: "prev-month"
                    })
            }
            t.setFullYear(u.year, u.month, 0);
            for (var r = 1, s = t.getDate(); r <= s; r++)
                e.push({
                    date: l(t.getFullYear(), t.getMonth() + 1, r),
                    day: r,
                    cls: "curr-month"
                });
            if (e.length % 7 > 0) {
                t.setFullYear(u.year, u.month, 1);
                for (var r = 1, s = 7 - e.length % 7; r <= s; r++)
                    e.push({
                        date: l(t.getFullYear(), t.getMonth() + 1, r),
                        day: r,
                        cls: "next-month"
                    })
            }
            u.dates = e,
            b.html(d(h, u))
        }
        function d(e, t) {
            var a = "var $out='" + e.replace(/[\r\n]/g, "").replace(/^(.+?)\{\{|\}\}(.+?)\{\{|\}\}(.+?)$/g, function(e) {
                return e.replace(/(['"])/g, "\\$1")
            }).replace(/\{\{\s*=\s*(.+?)\}\}/g, "';$out+=$1;$out+='").replace(/\{\{(.+?)\}\}/g, "';$1$out+='") + "';return new String($out);"
              , i = new Function("$data",a);
            return new i(t).toString()
        }
        function l(e, t, a) {
            return 3 != arguments.length && (t = e.month,
            a = e.day,
            e = e.year),
            u.format.replace(/[ymd]+/gi, function(i) {
                return i = i.toLowerCase(),
                "yyyy" == i ? e : "mm" == i ? t < 10 ? "0" + t : t : a < 10 ? "0" + a : a
            })
        }
        function s() {
            var e = {}
              , t = o.val()
              , a = 0
              , i = 0
              , n = 0
              , r = u.format.replace(/[ymd]+|[^ymd]/gi, function(e, t) {
                return e = e.toLowerCase(),
                "yyyy" == e ? (a = t,
                "\\d{4}") : "mm" == e ? (i = t,
                "\\d{2}") : "dd" == e ? (n = t,
                "\\d{2}") : "\\" + e
            })
              , d = new RegExp(r);
            if (d.test(t))
                e = {
                    year: t.substr(a, 4) - 0,
                    month: t.substr(i, 2) - 0,
                    day: t.substr(n, 2) - 0
                };
            else {
                var s = new Date;
                e = {
                    year: s.getFullYear(),
                    month: s.getMonth() + 1,
                    day: s.getDate()
                }
            }
            return e.date = l(e),
            e
        }
        var o = e(this)
          , c = o.offset()
          , u = {
            weekStart: 1,
            yearRange: [-6, 6],
            format: "yyyy-mm-dd",
            lang: "zh_CN"
        };
        e.extend(u, a),
        e.extend(u, {
            langPack: t.lang[u.lang],
            startYear: (new Date).getFullYear() + u.yearRange[0],
            endYear: (new Date).getFullYear() + u.yearRange[1],
            positionTop: c.top + o.outerHeight() + "px",
            positionLeft: c.left + "px"
        }, s());
        var f = '<div class="datepicker" style="top:{{=$data.positionTop}};left:{{=$data.positionLeft}}" ><div class="top"><div class="datepicker-select datepicker-select-year"><div class="datepicker-select-selected">{{=$data.year}}</div><ul class="datepicker-select-options">{{ for(var i=$data.startYear;i<=$data.endYear;i++){ }}<li data-year="{{=i }}" {{if(i==$data.year){ }}class="selected"{{ } }}>{{=i}}</li>{{ } }}</ul></div><div class="datepicker-select datepicker-select-month"><div class="datepicker-select-selected">{{=$data.month}}</div><ul class="datepicker-select-options">{{ for(var i=1;i<=12;i++){ }}<li data-month="{{=i }}" {{if(i==$data.month){ }}class="selected"{{ } }}>{{=i}}</li>{{ } }}</ul></ul></div></div><table class="body"><thead><tr>{{ for(var i=$data.weekStart;i<$data.weekStart + 7;i++){ }}<td class="cell week-cell">{{=$data.langPack.week[i % 7]}}</td>{{ } }}</tr></thead><tbody></tbody></table><div class="bottom"><div class="btn-clear">{{=$data.langPack.clearText}}</div></div></div>'
          , h = '<tr>{{var list=$data.dates;for(var i=0,j=list.length;i<j;i++){ }}<td class="cell {{= list[i].cls }} {{ if($data.date==list[i].date){  }}selected{{ } }}" data-date="{{= list[i].date }}">{{= list[i].day }}</td>{{ if ((i + 1) % 7 == 0 && i != j - 1) { }}</tr><tr>{{ } }}{{ } }}</tr>'
          , g = ".datepicker"
          , y = g + "-select"
          , p = y + "-options"
          , v = y + "-options li"
          , m = y + "-selected"
          , k = e(d(f, u)).appendTo("body")
          , $ = k.find(".datepicker-select-year")
          , w = k.find(".datepicker-select-month")
          , b = k.find(".body tbody");
        return k.defaults = u,
        k.on("click", y, function() {
            var t = e(this).find(p);
            e(this).siblings(y).find(p).fadeOut(150),
            t.is(":hidden") ? t.fadeIn(50) : t.fadeOut(150)
        }).on("click", v, function() {
            e(this).addClass("selected").siblings(".selected").removeClass("selected"),
            u.year = $.find(".selected").data("year"),
            u.month = w.find(".selected").data("month"),
            $.find(m).text(u.year),
            w.find(m).text(u.month),
            r()
        }).on("click", ".curr-month,.prev-month,.next-month", function() {
            b.find(".selected").removeClass("selected"),
            e(this).addClass("selected");
            var t = e(this).data("date");
            u.date = t,
            o.val(t),
            n()
        }).on("click", ".btn-clear", function() {
            o.val(""),
            n()
        }),
        o.on("focus", function() {
            i()
        }),
        e(document).on("mousedown", function(t) {
            var a = e(t.target);
            0 != a.closest(g).length || a.is(o) || n()
        }),
        k
    }
    t.lang = {
        zh_CN: {
            clearText: "清除",
            week: ["日", "一", "二", "三", "四", "五", "六"]
        },
        en_US: {
            clearText: "Clear",
            week: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"]
        }
    },
    e.fn.datepicker = t,
    e.fn.datepicker.lang = t.lang
}(jQuery);